
<!DOCTYPE html>
<head>
	<title>Time Use</title>
</head>
<meta charset="utf-8">
<style>
path {
  stroke: white;
  stroke-width: 0.25px;
  fill: grey;
}
</style>
<body>
	<div class="buttons">
		<button type="button" name="button"></button>

		<select id="categorySelect" onchange="updateMap()">
			<option value="personalCare">personalCare</option>
			<option value="sleep">sleep</option>
			<option value="resting">resting</option>
			<option value="aaa">TO Continue</option>
		</select>
	</div>








<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://d3js.org/topojson.v0.min.js"></script>
<script>
var width = 900,
    height = 500;

var projection = d3.geo.mercator()
    .scale(500)
	.translate([200,800]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var path = d3.geo.path()
    .projection(projection);

var g = svg.append("g");

// Import data
function toMinute(hour) {
	var a = hour.split(":");
	var minutes = 60*a[0] + 1*a[1];
	return minutes;
}
var maleData = {};
var femaleData = {};

d3.csv("TimeUse.csv")
	.row( (d,i) => {
		return {
			sex: d.SEX,
			country: d["GEO/ACLOO"],
			total: toMinute(d.Total),
			personalCare :toMinute(d['Personal care']),
			sleep:toMinute(d.Sleep),
			eating:toMinute(d.Eating),
			other : toMinute(d["Other and/or unspecified personal care"]),
			job: toMinute(d["Employment, related activities and travel as part of/during main and second job"]),
			jobbis: toMinute(d["Main and second job and related travel"]),
			joblinked:toMinute(d["Activities related to employment and unspecified employment"]),
			study : toMinute(d.Study),
			school: toMinute(d["School and university except homework"]),
			homework: toMinute(d.Homework),
			freeTime: toMinute(d["Free time study"]),
			householdAndFamilyCare: toMinute(d["Household and family care"]),
			food: toMinute(d["Food management except dish washing"]),
			dishWashing: toMinute(d["Dish washing"]),
			cleaningDwelling: toMinute(d["Cleaning dwelling"]),
			householdUpkeep: toMinute(d["Household upkeep except cleaning dwelling"]),
			laundry: toMinute(d.Laundry),
			ironing: toMinute(d.Ironing),
			handicraft: toMinute(d["Handicraft and producing textiles and other care for textiles"]),
			otherPetCare: toMinute(d["Gardening; other pet care"]),
			tendingAnimals: toMinute(d["Tending domestic animals"]),
			pets : toMinute(d["Caring for pets"]),
			walkingDog: toMinute(d["Walking the dog"]),
			construction: toMinute(d["Construction and repairs "]),
			shopping: toMinute(d["Shopping and services"]),
			childcare: toMinute(d["Childcare, except teaching, reading and talking"]),
			teachingChild: toMinute(d["Teaching, reading and talking with child"]),
			household: toMinute(d["Household management and help family member"]),
			associative: toMinute(d["Leisure, social and associative life"]),
			organisational: toMinute(d["Organisational work"]),
			help: toMinute(d["Informal help to other households"]),
			participatory: toMinute(d["Participatory activities"]),
			visiting: toMinute(d["Visiting and feasts"]),
			otherSocial: toMinute(d["Other social life"]),
			entertainment: toMinute(d["Entertainment and culture"]),
			resting: toMinute(d.Resting),
			walking: toMinute(d["Walking and hiking"]),
			sport: toMinute(d["Sports and outdoor activities except walking and hiking"]),
			computerGames : toMinute(d["Computer games"]),
			computing: toMinute(d.Computing),
			hobbies: toMinute(d["Hobbies and games except computing and computer games"]),
			books: toMinute(d["Reading books"]),
			otherReading: toMinute(d["Reading, except books"]),
			tv: toMinute(d["TV and video"]),
			radio: toMinute(d["Radio and music"]),
			otherLeisure: toMinute(d["Unspecified leisure "]),
			travel: toMinute(d["Travel except travel related to jobs"]),
			workToTravel: toMinute(d["Travel to/from work"]),
			studyTravel: toMinute(d["Travel related to study"]),
			shoppingTravel: toMinute(d["Travel related to shopping and services"]),
			childTransport: toMinute(d["Transporting a child"]),
			otherHouseholdTravel: toMinute(d["Travel related to other household purposes"]),
			leisureTravel: toMinute(d["Travel related to leisure, social and associative life"]),
			otherTravel: toMinute(d["Unspecified travel"]),
			unspecified: toMinute(d["Unspecified time use"])
		};
	})
	.get( (error, rows) => {

		rows.forEach(function(d){
			if(d.sex = "Males"){
				maleData[d.country] = d;}
			else{
				femaleData[d.country] = d;}
		});
		console.log(rows.length+ " data rows imported");
	});


// Import country Names
var countryNames = {};
d3.tsv("world-110m-country-names.tsv",function(error,rows){

	rows.forEach(function(d){
		if(d.id>=1){
			countryNames[d.id] = d.name;
		}
	});
});



// THE FUNCTION TO CHANGE TO DISPLAY DATA
function getColor(d) {
	var id = d.id;
	if (id>=1){
			var country = countryNames[id];
			var category = document.getElementById("categorySelect").value;

			if(country in maleData){
				//var result = maleData[country].resting;
				var result = maleData[country][category];
				if (result!=null){
					return (d3.rgb(10*result,0,0));}
			}
		}

	return(d3.rgb(150,150,150));
}
// load and display the World
var map;
d3.json("world-110m2.json", function(error, topology) {

map = g.selectAll("path")
      .data(topojson.object(topology, topology.objects.countries)
          .geometries);
map.enter()
      .append("path")
      .attr("d", path)
	  .style("fill",function (d,i) { return getColor(d) })
});

function updateMap() {
	map.exit().remove();
	map.enter()
	      .append("path")
	      .attr("d", path)
		  .style("fill",function (d,i) { return getColor(d) });
}

// zoom and pan
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")
            .attr("d", path.projection(projection));

  });

svg.call(zoom)

</script>
</body>
</html>
